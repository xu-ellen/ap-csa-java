<!DOCTYPE HTML>
<html xmlns:layout="http://www.w3.org/1999/xhtml" xmlns:th="http://www.w3.org/1999/xhtml"
      layout:decorate="~{layouts/base}" lang="en">

<head>
  <title>Lightboard Game of Life</title>
</head>

<body>
  <th:block layout:fragment="body" th:remove="tag">
    <!-- Start of body content specific to page -->
    <div class="px-4 py-5 my-5">
        <h3 class="display-5 fw-bold">Lightboard Game of Life</h3>
    </div>
    <!-- End of body content specific to page -->
    <input type="text" id="input"></input>
    <button onclick="simulate(document.getElementById('input').value)">Simulate</button>
    <div id="result">
    </div>
  </th:block>
</body>

<th:block layout:fragment="script" th:remove="tag">
<script>
  function simulate(generation){
    console.log("button clicked");
    fetch("/api/lightboard/simulate/"+(parseInt(generation)-1), {"method": "GET"}) // generation - 1 because 0 indexing
    // response is a RESTful "promise" on any successful fetch
    .then(response => {
    // check for response errors
    if (response.status !== 200) {
        error("GET API response failure: " + response.status)
        return;  // api failure
    }
    // valid response will have JSON data
    response.json().then(data => {

      console.log(data);

      // json output is an Array where each element is a Lightboard
      // each Lightboard has 3x3 array of Lights
      // each Light has dictionary of on/off, rgb, effect

      // create a table for each Lightboard
      var table = document.createElement("table");
      table.setAttribute("border", "1");
      table.setAttribute("style", "border-collapse: collapse;");
      var tableBody = document.createElement("tbody");

      for (var i = 0; i < data.length; i++) {
        var row = document.createElement("tr");

        for (var j = 0; j < data[i].lights.length; j++) {
          var cell = document.createElement("td");

          // create a div for each Light
          var light = document.createElement("div");
          light.setAttribute("style", "width: 50px; height: 50px; background-color: " + data[i].lights[j].rgb + ";");

          cell.appendChild(light);
          row.appendChild(cell);
        }
        tableBody.appendChild(row);
      }
      table.appendChild(tableBody);
      document.getElementById("result").appendChild(table);
      
    })
    // catch fetch errors
    .catch(err => {
    error(err + " " );
    });
    })
  }
</script>
</th:block>

</html>